@{
    ViewData["Title"] = "Yönetim Paneli";
}

<div class="container py-4">
    <div class="row align-items-center mb-4">
        <div class="col">
            <h1 class="mb-0">Yönetim Paneli</h1>
        </div>
        <div class="col-auto">
        </div>
    </div>

    <!-- Özet İstatistikler -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card bg-primary text-white h-100">
                <div class="card-body d-flex flex-column">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="card-title mb-0">Toplam Kullanıcı</h6>
                        <i class="fas fa-users fa-2x"></i>
                    </div>
                    <h2 class="mt-3 mb-0">@ViewBag.ToplamKullanici</h2>
                </div>
                <div class="card-footer d-flex justify-content-between align-items-center">
                    <span>Aktif: @ViewBag.AktifKullanici / Pasif: @ViewBag.PasifKullanici</span>
                    <a asp-controller="Admin" asp-action="Kullanicilar" class="text-white">
                        <i class="fas fa-arrow-circle-right"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card bg-success text-white h-100">
                <div class="card-body d-flex flex-column">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="card-title mb-0">Toplam Proje</h6>
                        <i class="fas fa-project-diagram fa-2x"></i>
                    </div>
                    <h2 class="mt-3 mb-0">@ViewBag.ToplamProje</h2>
                </div>
                <div class="card-footer d-flex justify-content-between align-items-center">
                    <span>Devam Eden: @ViewBag.DevamEdenProjeSayisi / Tamamlanan: @ViewBag.TamamlananProjeSayisi</span>
                    <a asp-controller="Proje" asp-action="Index" class="text-white">
                        <i class="fas fa-arrow-circle-right"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card bg-info text-white h-100">
                <div class="card-body d-flex flex-column">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="card-title mb-0">Akademisyenler</h6>
                        <i class="fas fa-user-tie fa-2x"></i>
                    </div>
                    <h2 class="mt-3 mb-0">@ViewBag.AkademisyenSayisi</h2>
                </div>
                <div class="card-footer d-flex justify-content-between align-items-center">
                    <span>Akademisyen Sayısı</span>
                    <a asp-controller="Admin" asp-action="Kullanicilar" asp-route-rol="Akademisyen" class="text-white">
                        <i class="fas fa-arrow-circle-right"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card bg-warning text-white h-100">
                <div class="card-body d-flex flex-column">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="card-title mb-0">Öğrenciler</h6>
                        <i class="fas fa-user-graduate fa-2x"></i>
                    </div>
                    <h2 class="mt-3 mb-0">@ViewBag.OgrenciSayisi</h2>
                </div>
                <div class="card-footer d-flex justify-content-between align-items-center">
                    <span>Öğrenci Sayısı</span>
                    <a asp-controller="Admin" asp-action="Kullanicilar" asp-route-rol="Ogrenci" class="text-white">
                        <i class="fas fa-arrow-circle-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Kullanıcı Kayıt Grafiği -->
        <div class="col-lg-8 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Aylık Kullanıcı Kayıtları</h5>
                </div>
                <div class="card-body">
                    <canvas id="kullaniciGrafik" width="100%" height="40"></canvas>
                </div>
            </div>
        </div>

        <!-- Rol Dağılımı Grafiği -->
        <div class="col-lg-4 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Kullanıcı Rol Dağılımı</h5>
                </div>
                <div class="card-body">
                    <canvas id="rolGrafik" width="100%" height="40"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Proje Durum Grafiği -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Proje Durumları</h5>
                </div>
                <div class="card-body">
                    <canvas id="projeDurumGrafik" width="100%" height="40"></canvas>
                </div>
            </div>
        </div>

        <!-- En Aktif Akademisyenler -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-light">
                    <h5 class="mb-0">En Aktif Akademisyenler</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-striped mb-0">
                            <thead>
                                <tr>
                                    <th>Ad Soyad</th>
                                    <th>Unvan</th>
                                    <th class="text-center">Proje Sayısı</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (ViewBag.AkademisyenProjeSayilari != null)
                                {
                                    @foreach (var item in ViewBag.AkademisyenProjeSayilari)
                                    {
                                        <tr>
                                            <td>@item.Akademisyen.Ad @item.Akademisyen.Soyad</td>
                                            <td>@item.Akademisyen.Unvan</td>
                                            <td class="text-center">
                                                <span class="badge bg-info">@item.ProjeSayisi</span>
                                            </td>
                                        </tr>
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Son Eklenen Kullanıcılar -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Son Eklenen Kullanıcılar</h5>
                    <a asp-controller="Admin" asp-action="Kullanicilar" class="btn btn-sm btn-outline-primary">Tümünü Gör</a>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Ad Soyad</th>
                                    <th>Email</th>
                                    <th>Rol</th>
                                    <th>Kayıt Tarihi</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (ViewBag.SonKullanicilar != null)
                                {
                                    @foreach (var kullanici in ViewBag.SonKullanicilar)
                                    {
                                        <tr>
                                            <td>@kullanici.Ad @kullanici.Soyad</td>
                                            <td>@kullanici.Email</td>
                                            <td>
                                                <span class="badge @GetRolBadge(kullanici.Rol)">@kullanici.Rol</span>
                                            </td>
                                            <td>@kullanici.CreatedAt.ToString("dd.MM.yyyy HH:mm")</td>
                                        </tr>
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Son Eklenen Projeler -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Son Eklenen Projeler</h5>
                    <a asp-controller="Proje" asp-action="Index" class="btn btn-sm btn-outline-primary">Tümünü Gör</a>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Proje Adı</th>
                                    <th>Öğrenci</th>
                                    <th>Danışman</th>
                                    <th>Durum</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (ViewBag.SonProjeler != null)
                                {
                                    @foreach (var proje in ViewBag.SonProjeler)
                                    {
                                        <tr>
                                            <td>@proje.Ad</td>
                                            <td>@(proje.Ogrenci != null ? $"{proje.Ogrenci.Ad} {proje.Ogrenci.Soyad}" : "-")</td>
                                            <td>@(proje.Mentor != null ? $"{proje.Mentor.Unvan} {proje.Mentor.Ad} {proje.Mentor.Soyad}" : "-")</td>
                                            <td>
                                                <span class="badge @GetProjeDurumBadge(proje.Status)">@proje.Status</span>
                                            </td>
                                        </tr>
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Kullanıcı Kayıt Grafiği
            var kullaniciCtx = document.getElementById('kullaniciGrafik').getContext('2d');
            var kullaniciGrafik = new Chart(kullaniciCtx, {
                type: 'bar',
                data: {
                    labels: [
                        @{
                            var labelsList = new List<string>();
                            foreach (var kayit in ViewBag.AylikKayitlar)
                            {
                                labelsList.Add($"'{kayit.Key}'");
                            }
                            @Html.Raw(string.Join(",", labelsList));
                        }
                    ],
                    datasets: [{
                        label: 'Kayıt Sayısı',
                        data: [
                            @{
                                var valuesList = new List<int>();
                                foreach (var kayit in ViewBag.AylikKayitlar)
                                {
                                    valuesList.Add(kayit.Value);
                                }
                                @Html.Raw(string.Join(",", valuesList));
                            }
                        ],
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Son 6 Ayın Kullanıcı Kayıtları'
                        }
                    }
                }
            });

            // Rol Dağılım Grafiği
            var rolCtx = document.getElementById('rolGrafik').getContext('2d');
            var rolGrafik = new Chart(rolCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Admin', 'Akademisyen', 'Öğrenci'],
                    datasets: [{
                        data: [@ViewBag.AdminSayisi, @ViewBag.AkademisyenSayisi, @ViewBag.OgrenciSayisi],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.6)',
                            'rgba(54, 162, 235, 0.6)',
                            'rgba(75, 192, 192, 0.6)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(75, 192, 192, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    plugins: {
                        title: {
                            display: true,
                            text: 'Kullanıcı Rolleri'
                        }
                    }
                }
            });

            // Proje Durum Grafiği
            var projeDurumCtx = document.getElementById('projeDurumGrafik').getContext('2d');
            var projeDurumGrafik = new Chart(projeDurumCtx, {
                type: 'pie',
                data: {
                    labels: ['Beklemede', 'Devam Eden', 'Tamamlanan', 'İptal'],
                    datasets: [{
                        data: [@ViewBag.BeklemedeProjeSayisi, @ViewBag.DevamEdenProjeSayisi, @ViewBag.TamamlananProjeSayisi, @ViewBag.IptalProjeSayisi],
                        backgroundColor: [
                            'rgba(255, 206, 86, 0.6)',
                            'rgba(54, 162, 235, 0.6)',
                            'rgba(75, 192, 192, 0.6)',
                            'rgba(255, 99, 132, 0.6)'
                        ],
                        borderColor: [
                            'rgba(255, 206, 86, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(255, 99, 132, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    plugins: {
                        title: {
                            display: true,
                            text: 'Proje Durumlarına Göre Dağılım'
                        }
                    }
                }
            });
        });
    </script>
}

@functions {
    public string GetRolBadge(string rol)
    {
        return rol switch
        {
            "Admin" => "bg-danger",
            "Akademisyen" => "bg-primary",
            "Ogrenci" => "bg-success",
            _ => "bg-secondary"
        };
    }

    public string GetProjeDurumBadge(string durum)
    {
        return durum switch
        {
            "Beklemede" => "bg-warning",
            "Atanmis" => "bg-info",
            "Devam" => "bg-primary",
            "Tamamlandi" => "bg-success",
            "Iptal" => "bg-danger",
            _ => "bg-secondary"
        };
    }
} 